@{
    ViewData["Title"] = "Tasks";
    var user = (User)ViewBag.User;
}
@model TaskModel;

<script>
    //$('.file-upload').file_upload();
</script>
<section>
    <form asp-controller="Home" asp-action="Tasks" method="post" enctype="multipart/form-data">
        <div class="row">
            <div class="form-group">
                <input type="hidden" asp-for="FromUser" value="@user.Id" />

                <div class="form-group mt-5">
                    <label for="toUser">Кому:</label>
                    <select class="custom-select" asp-for="ToUser" id="ToUser">
                        @foreach (var temp in ViewBag.Users)
                        {
                            <option value="@temp.Id">@(temp.GetFullName())</option>
                        }
                    </select>
                </div>

                <div class="mt-4">
                    <label for="date">DeadLine:</label>
                    <input type="date" id="date" class="form-control" asp-for="DeadLine">
                </div>

                <div class="mt-4">
                    <label for="text">Текст задачи:</label>
                    <input type="text" id="text" class="form-control" asp-for="Text">
                </div>

                <div>
                    <div id="fileBasket" class="filebasket">
                        Drag-n-Drop files here.
                    </div>
                    @*<div class="file-upload-wrapper mt-4">
                        <input type="file" id="input-file-now" asp-for="Files" class="file-upload" />
                    </div>*@
                </div>

                <input type="submit" class="btn btn-dark mt-4" />
            </div>

        </div>
    </form>
    
    <div id="FilesList">
    </div>

</section>
<section>
    <div class="container">
        <div class="row">
            @foreach (var temp in ViewBag.Tasks)
            {
                <p>@temp.Text;</p>
            }
        </div>
    </div>
</section>


<script>
    $(document).ready(function () {

        $("#progress").hide();

        $("#fileBasket").on("dragenter", function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
        });

        $("#fileBasket").on("dragover", function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
        });

        $("#fileBasket").on("drop", function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
        });
    });

    $("#fileBasket").on("drop", function (evt) {
        evt.preventDefault();
        evt.stopPropagation();
        var files = evt.originalEvent.dataTransfer.files;
        var fileNames = "";
        if (files.length > 0) {
            fileNames += "Uploading <br/>"
            for (var i = 0; i < files.length; i++) {
                fileNames += files[i].name + "<br />";
            }
        }
        $("#fileBasket").html(fileNames);

        var data = new FormData();
        for (var i = 0; i < files.length; i++) {
            data.append(files[i].name, files[i]);
        }
        $.ajax({
            type: "POST",
            url: "/home/UploadFiles",
            contentType: false,
            processData: false,
            data: data,
            success: function (urls) {
                $("#fileBasket").html("Success!");

                urls.forEach(function (item, i, urls) {
                    $("#FilesList").append(`<img src="`+item+`" alt="Alternate Text" />`);
                });
            },
            error: function () {
                $("#fileBasket").html
                    ("There was error uploading files!");
            },
            beforeSend: function () {
                $("#progress").show();
            },
            complete: function () {
                $("#progress").hide();
            }
        });
    });
</script>


